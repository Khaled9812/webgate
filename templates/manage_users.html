{% extends 'layout.html' %}
{% block content %}
<h1 class="page-title">User Management</h1>
<div class="admin-wrapper">
    <section class="form-card">
        <h2>Add User</h2>
        <form method="post">
            <input type="hidden" name="action" value="add_user">
            <label for="username">Username</label>
            <input id="username" type="text" name="username" required>
            <label for="password">Password</label>
            <input id="password" type="password" name="password" required>
            <label for="confirm">Confirm Password</label>
            <input id="confirm" type="password" name="confirm" required>
            <label for="role">Role</label>
            <select id="role" name="role">
                <option value="user">User</option>
                <option value="admin">Admin</option>
            </select>
            <button type="submit">Create User</button>
        </form>
    </section>
    <section class="list-section">
        <h2>Existing Users</h2>
        <table class="table-list">
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Role</th>
                    <th>Sites</th>
                    <th>Created</th>
                    <th>Last Login</th>
                    <th>Last Activity</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>{{ user['username'] }}</td>
                    <td>{{ 'Admin' if user['is_admin'] else 'User' }}</td>
                    <td>{{ user['site_count'] }}</td>
                    <td>{{ user['created_at'] }}</td>
                    <td>{{ user['last_login'] if user['last_login'] else '-' }}</td>
                    <td>{{ user['last_activity'] if user['last_activity'] else '-' }}</td>
                    <td>
                        <form method="post" class="inline-form" style="display:inline-block; margin-right:0.5rem;">
                            <input type="hidden" name="action" value="toggle_role">
                            <input type="hidden" name="user_id" value="{{ user['id'] }}">
                            <button type="submit">{{ 'Make User' if user['is_admin'] else 'Make Admin' }}</button>
                        </form>
                        <form method="post" class="inline-form" style="display:inline-block;">
                            <input type="hidden" name="action" value="delete_user">
                            <input type="hidden" name="user_id" value="{{ user['id'] }}">
                            <button type="submit" onclick="return confirm('Are you sure you want to delete this user?');">Delete</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>
</div>
{% endblock %}